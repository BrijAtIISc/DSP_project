# Market Sentiment & Index Movements - A Correlation Studyâ€‹

## Team Members
- Brijgopal Bharadwaj, DSBA
- Chandan Rao, DSBA
- Danish Akhlaq, DSBA


## Table of Contents

- [Introduction](#introduction)
- [Problem Statement](#problem-statement)
- [How to Reproduce the Project](#how-to-reproduce-the-project)
- [Dataset Overview](#dataset-overview)
- [Data Preparation and Preprocessing](#data-preparation-and-preprocessing)
- [Exploratory Data Analysis (EDA)](#exploratory-data-analysis-eda)
- [Modeling and Prediction](#modeling-and-prediction)
- [Evaluation Metrics](#evaluation-metrics)
- [Future Work](#Future-Work)


## Introduction

The news media plays a pivotal role in shaping public opinion, including investor sentiment. This influence can significantly impact stock prices and market trends. By leveraging the power of data science, we aim to quantify and analyze the impact of news media on stock market movements.

## Problem Statement
While news media is a valuable source of information for investors, it can also be a tool for manipulating public perception and influencing investment decisions. This dynamic presents a significant challenge for investors seeking to make informed decisions.
#### Why is it important?
- This dynamic provides us a metric that can be utilized in forecasting and market-movement prediction models.
- Knowledge about these influences might help the common investor be more perceptive to the way these influences can creep into their investment patterns.
- An extremely biased media-source might be a candidate for further investigation by the regulatory authorities like SEBI to uncover undue practices/agendas.
#### Objectives of the project
- Develop a real-time pipeline that analyzes news articles and assigns bias scores using machine learning.
- Calculate correlation between news bias and market movements.
- Leverage the insights to forecast short-term market trends.
#### How can Data Science solve the problem?
- Build a model using BERT embeddings and a XGBoost regressor to assign bias scores.
- Apply the model to analyze news in real-time and calculate correlation scores.
- Utilize these insights for forecasting market trends.


## How to Reproduce the Project

1. Clone the repository:
    ```git clone https://github.com/BrijAtIISc/DSP_project.git```
2. Navigate to the project folder:
    ```cd DSP_project```
3. Install dependencies:
    ```pip install -r requirements.txt```
4. In case fresh data is required:
    * Set the following environment variables:
        ```
            export GCSJ_API_KEY=<YOUR_GOOGLE_CUSTOM_SEARCH_API_KEY>
            export GCSJ_ENGINE_ID=<YOUR_GOOGLE_SEARCH_ENGINE_ID>
        ```
    * Run the data collection playbooks:
        - `Code/01-data-collection-news-companies.ipynb`
        - `Code/02-data-collection-news-market.ipynb`
        - `Code/03-data-collection-stocks.ipynb`
5. Run the data preprocessing playbooks:
    * `Code/03-data-preprocessing-news-companies.ipynb`
    * `Code/04-data-preprocessing-news-market.ipynb`
    * `Code/06-data-preprocessing-stocks.ipynb`
5. To perform EDA, use the following playbooks:
    * `Code/05-EDA-news-companies.ipynb`
    * `Code/06-EDA-news-market.ipynb`
    * `Code/09-EDA-stoks.ipynb`


---

## Dataset Overview

The dataset consists of two main components:
1. **News Articles Dataset:**
    - Contains news articles from various sources related to companies and the stock market.
    - The datasets have been generated by fetching news articles from the NewsAPI and web scrapping (Google Custom Search API).
    - Features include Author, Title, Description, URL, UrlToImage, Source, Content and Published date.

2. **Market Data Dataset:**
    - This datasets have been extraced using yahoo finance.
    - Contains historical stock market data, including Open, High, Low, Close, Volume, and Adjusted Close prices.
    - Features include Date, Ticker, and Company Name.

## Data Preparation and Preprocessing

- Handled missing values using imputation techniques.
- Removed outliers.
- Converted categorical data into appropriate formats using one-hot encoding.
- Created new features for VADER Sentiment Scores using NLP pipelines from `nltk`.
- Created news article summaries using `pipeline` from `transformers` library (by HuggingFace).


## Exploratory Data Analysis (EDA)

Comprehensive EDA was performed to understand data distributions and relationships:

- Distribution of News across dates: Found that ratings were positively skewed, with most apps rated above 3.5.
- Distribution of News-article summary lengths: Found that most summaries were between 100-200 words.
- Distribution of Sentiment Scores: Found that most articles had a neutral sentiment.
- Distribution of Market Data across time


## Modeling and Prediction

### Machine Learning Models Implemented:
- **Market Sentiment Classification:** 
    - Used BERT embeddings and DNN classifier to assign `bearish` / `neutral` / `bullish` labels to news articles.
    - Achieved an accuracy of 90% on the test set.
- **Market Price Forecasting (Regression):**
    - Used xgboost to predict the next-day market movement based on news sentiment scores and technical parameters of previous days.
    - Achieved an RMSE score of 149.13 on the test set.
### Hyperparameter Tuning:
> Using hyperparameter tuning to optimize the performance of an XGBoost regression model for predicting stock prices, specifically the "Close" price.
- Hyperparameter Tuning with Bayesian Optimization
    - A base XGBRegressor model is initialized.
    - A parameter grid is defined for tuning key hyperparameters like:
        - n_estimators: Number of trees.
        - learning_rate: Learning rate for gradient descent.
        - max_depth: Maximum depth of trees.
        - subsample: Fraction of samples used for training each tree.
        - colsample_bytree: Fraction of features considered at each split.
    - BayesSearchCV is used for tuning the hyperparameters, optimizing for negative mean squared error (neg_mean_squared_error) using 15-fold cross-validation.
    - The best hyperparameters are identified as below.
`````
OrderedDict({'colsample_bytree': 0.8, 'learning_rate': 0.05479350229402818, 'max_depth': 3, 'n_estimators': 300, 'subsample': 0.8})
`````


## Evaluation Metrics

| Performance Metrics      | Values |
| -------------     | ------------- |
| Accuracy      | 96.91%  |
| Precision     | 96.94%  |
| Recall        | 96.91%  |
| F1 Score      | 96.91%  |
| R2 score      | 0.7835  |
| RMSE Value      | 138.79  |


## Future Work

- Compare BERT performance with other text-embedding models like Word2Vec, etc.
- Assimilate dataset for a longer time-window to obtain higher performance.
